{
  "project": "SFL Prompt Studio v2",
  "generated_at": "2026-02-09T22:05:00.000Z",
  "context": "Backlog derived from system design review iterations 1 & 2. Focus areas: Security, Architecture, Maintenance, and Reliability.",
  "backlog": [
    {
      "id": "SEC-001",
      "title": "Migrate Sandbox Service to Web Worker/WASM",
      "category": "Security & Stability",
      "priority": "High",
      "status": "Pending",
      "affected_files": [
        "src/services/sandboxService.ts",
        "src/services/workflowEngine.ts"
      ],
      "description": "The current `sandboxService.ts` uses a hidden iframe with `allow-scripts`. While isolated by origin, code execution on the main thread (even inside an iframe) can cause UI freezing if the user code contains infinite loops, and `new Function` is less secure than a true sandbox.",
      "implementation_instructions": [
        "Create a new Web Worker file (e.g., `src/workers/codeExecutor.worker.ts`) to handle code execution off the main thread.",
        "Integrate a WASM-based Javascript runtime (like `quickjs-emscripten`) inside the worker to strictly isolate the execution environment from the browser APIs.",
        "Refactor `runSafeCode` in `sandboxService.ts` to instantiate the Worker and communicate via `postMessage`.",
        "Ensure the 5-second timeout logic terminates the Worker instance to effectively kill infinite loops.",
        "Remove the legacy iframe implementation."
      ]
    },
    {
      "id": "ARCH-001",
      "title": "Centralize AI Model Configuration",
      "category": "Architecture",
      "priority": "Medium",
      "status": "Pending",
      "affected_files": [
        "src/services/providers/GeminiProvider.ts",
        "src/services/validationService.ts",
        "src/constants.ts",
        "src/types/ai.ts"
      ],
      "description": "Hardcoded model strings (e.g., 'gemini-2.5-flash') are scattered across providers, validation logic, and default workflows. This makes updating the default model version difficult.",
      "implementation_instructions": [
        "Create a new configuration file `src/config/models.ts`.",
        "Define constants for model IDs (e.g., `DEFAULT_GEMINI_MODEL`, `VALIDATION_MODELS`).",
        "Update `GeminiProvider.ts` to use `config?.model || DEFAULT_GEMINI_MODEL`.",
        "Refactor `validateApiKey` in `validationService.ts` to use the centralized constants.",
        "Update `DEFAULT_WORKFLOWS` in `constants.ts` to reference these constants instead of raw strings.",
        "Add a `model` field to the global `AppConstants` in `useStore.ts` to allow runtime configuration."
      ]
    },
    {
      "id": "MAINT-001",
      "title": "Migrate to @xyflow/react (React Flow v12)",
      "category": "Maintenance",
      "priority": "Medium",
      "status": "Pending",
      "affected_files": [
        "package.json",
        "src/components/lab/WorkflowCanvas.tsx",
        "src/components/lab/TaskNode.tsx",
        "src/components/lab/modals/WorkflowEditorModal.tsx"
      ],
      "description": "The project uses `reactflow` v11, which is in maintenance mode. The new package `@xyflow/react` is required for long-term support and better compatibility with React 19.",
      "implementation_instructions": [
        "Uninstall `reactflow` and install `@xyflow/react`.",
        "Update all imports from `reactflow` to `@xyflow/react`.",
        "Import the CSS from `@xyflow/react/dist/style.css` (check documentation for exact path).",
        "Verify all `Node` and `Edge` type definitions match the new v12 API.",
        "Test the `WorkflowCanvas` for regression, specifically zooming, panning, and node dragging interactions."
      ]
    },
    {
      "id": "REL-001",
      "title": "Implement Robust Templating Engine",
      "category": "Reliability",
      "priority": "Low",
      "status": "Pending",
      "affected_files": [
        "src/services/workflowEngine.ts"
      ],
      "description": "The `templateString` function currently uses a simple Regex replacement (`{{key}}`). This fails on nested objects or missing keys, causing runtime errors or malformed prompts.",
      "implementation_instructions": [
        "Install a lightweight templating library like `mustache` or `handlebars` (or a smaller alternative like `eta`).",
        "Refactor `templateString` in `workflowEngine.ts` to use this library.",
        "Ensure the new engine handles `null`/`undefined` values gracefully (e.g., replacing with an empty string or retaining the tag for debugging).",
        "Update unit tests (if any) or add manual tests for nested data interpolation (e.g., `{{user.address.city}}`)."
      ]
    },
    {
      "id": "PERF-001",
      "title": "Implement Prompt Library Pagination",
      "category": "Performance",
      "priority": "Low",
      "status": "Pending",
      "affected_files": [
        "src/store/useStore.ts",
        "src/components/PromptList.tsx",
        "src/utils/storage.ts"
      ],
      "description": "The `init` function in `useStore.ts` loads all prompts synchronously. As the library grows, this will block the main thread during startup.",
      "implementation_instructions": [
        "Modify `storage.getAllPrompts()` to accept `page` and `limit` parameters.",
        "Update `useStore` to hold a `pagination` state (currentPage, totalItems).",
        "Refactor `init` to load only the first 20-50 prompts.",
        "Update `PromptList.tsx` to implement an 'Infinite Scroll' or 'Load More' button that triggers a `loadMorePrompts` action in the store."
      ]
    }
  ]
}
